<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>BeatMaster - MIDI Drum Rhythm Game</title>
    <!-- Favicon -->
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ü•Å</text></svg>">
    <link rel="stylesheet" href="style.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700&family=Black+Han+Sans&display=swap"
        rel="stylesheet">
    <!-- Tone.js MIDI Library -->
    <script src="https://unpkg.com/@tonejs/midi"></script>
</head>

<body>
    <div id="app">
        <!-- Overlay for Start/Pause -->
        <div id="overlay" class="visible">
            <div class="glass-panel">
                <h1 class="logo">BEAT<span>MASTER</span></h1>
                <p class="tagline">Premium MIDI Drum Experience</p>

                <div class="controls-grid">
                    <div class="control-item">
                        <label>Í≥° ÏÑ†ÌÉù (Internal)</label>
                        <select id="song-select">
                            <option value="">ÌååÏùºÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>
                            <!-- JSÏóêÏÑú ÎèôÏ†ÅÏúºÎ°ú Ï∂îÍ∞Ä -->
                        </select>
                    </div>
                </div>

                <div class="settings-row">
                    <div class="setting-item">
                        <label>ÎÇúÏù¥ÎèÑ ÏÑ§Ï†ï</label>
                        <div id="difficulty-select" class="btn-group">
                            <button class="difficulty-btn" data-value="EASY">EASY</button>
                            <button class="difficulty-btn active" data-value="NORMAL">NORMAL</button>
                            <button class="difficulty-btn" data-value="HARD">HARD</button>
                        </div>
                    </div>
                </div>

                <div class="settings-row">
                    <div class="setting-item">
                        <label>ÎÖ∏Ìä∏ ÏÜçÎèÑ</label>
                        <input type="range" id="scroll-speed" min="1" max="10" value="4" step="0.5">
                        <span id="speed-value">4.0</span>
                    </div>
                </div>

                <button id="start-btn" class="primary-btn" style="margin-top: 2rem;">START SESSION</button>

                <div class="settings-row"
                    style="margin-top: 1.5rem; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 1rem;">
                    <div class="control-item" style="width: 100%;">
                        <label style="opacity: 0.6; font-size: 0.8rem;">ÎòêÎäî Í∞úÏù∏ MIDI ÌååÏùº ÏßÅÏ†ë ÏóÖÎ°úÎìú</label>
                        <input type="file" id="midi-upload" accept=".mid,.midi" style="width: 100%; opacity: 0.7;">
                    </div>
                </div>
            </div>
        </div>

        <!-- Game Interface -->
        <main id="game-container">
            <!-- HP Gauge (Vertical Sidebar) -->
            <div id="hp-container">
                <div id="hp-bar-fill"></div>
                <div class="hp-label">HP</div>
            </div>

            <div id="hud">
                <div class="hud-top">
                    <div class="score-container">
                        <span class="label">SCORE</span>
                        <span id="score">000000</span>
                    </div>
                    <div class="hud-controls">
                        <button id="pause-btn" class="icon-btn">II</button>
                        <button id="fullscreen-btn" class="icon-btn">FS</button>
                    </div>
                    <div class="combo-container">
                        <span id="combo">0</span>
                        <span class="label">COMBO</span>
                    </div>
                </div>
                <div class="hud-bottom">
                    <div class="progress-bar-bg">
                        <div id="progress-bar-fill"></div>
                    </div>
                    <span id="time-display">00:00 / 00:00</span>
                </div>
            </div>

            <div id="judgment-display"></div>
            <div id="countdown-display"></div>

            <canvas id="game-canvas"></canvas>

            <!-- Touch Zones for Mobile & Hand-feel -->
            <div id="touch-zones">
                <div class="touch-zone arcade-btn" data-lane="0" data-key="D">
                    <div class="arcade-icon kick"></div>
                </div>
                <div class="touch-zone arcade-btn" data-lane="1" data-key="F">
                    <div class="arcade-icon snare"></div>
                </div>
                <div class="touch-zone arcade-btn" data-lane="2" data-key="J">
                    <div class="arcade-icon hihat"></div>
                </div>
                <div class="touch-zone arcade-btn" data-lane="3" data-key="K">
                    <div class="arcade-icon crash"></div>
                </div>
                <!-- Result Overlay -->
                <div id="result-overlay" class="game-overlay">
                    <div class="result-box glass-panel">
                        <h2 class="title">SESSION COMPLETE</h2>
                        <div class="rank-display">
                            <span id="result-rank">-</span>
                            <p>RANK</p>
                        </div>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <span class="label">PERFECT</span>
                                <span id="stat-perfect" class="value perfect">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="label">GOOD</span>
                                <span id="stat-good" class="value good">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="label">MISS</span>
                                <span id="stat-miss" class="value miss">0</span>
                            </div>
                        </div>
                        <div class="stat-summary">
                            <div class="stat-row">
                                <span>MAX COMBO</span>
                                <span id="stat-maxcombo">0</span>
                            </div>
                            <div class="stat-row highlight">
                                <span>TOTAL SCORE</span>
                                <span id="stat-score">000000</span>
                            </div>
                        </div>
                        <button class="primary-btn restart-btn">RETRY SESSION</button>
                        <button class="secondary-btn home-btn">BACK TO MENU</button>
                    </div>
                </div>

                <!-- Game Over Overlay -->
                <div id="game-over-overlay" class="game-overlay">
                    <div class="fail-box glass-panel">
                        <h2 class="title fail">SESSION FAILED</h2>
                        <p class="fail-msg">HP DEPLETED</p>
                        <button class="primary-btn restart-btn">RETRY SESSION</button>
                        <button class="secondary-btn home-btn">BACK TO MENU</button>
                    </div>
                </div>

        </main>

        <!-- Debug Console -->
        <div id="debug-console"></div>
    </div>

    <script type="module">
        import(`./main.js?v=${Date.now()}`);
    </script>
</body>

</html>