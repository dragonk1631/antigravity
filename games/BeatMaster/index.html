<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>BeatMaster - MIDI Drum Rhythm Game</title>
    <!-- Favicon -->
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ü•Å</text></svg>">
    <link rel="stylesheet" href="style.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700&family=Black+Han+Sans&display=swap"
        rel="stylesheet">
    <!-- Tone.js MIDI Library -->
    <script src="https://unpkg.com/@tonejs/midi"></script>
</head>

<body>
    <div id="app">
        <!-- Overlay for Start/Pause -->
        <div id="overlay" class="visible">
            <div class="glass-panel">
                <h1 class="logo">BEAT<span>MASTER</span></h1>
                <p class="tagline">Premium MIDI Drum Experience</p>

                <div class="controls-grid">
                    <div class="control-item">
                        <label>Í≥° ÏÑ†ÌÉù (Internal)</label>
                        <select id="song-select">
                            <option value="">ÌååÏùºÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>
                            <!-- JSÏóêÏÑú ÎèôÏ†ÅÏúºÎ°ú Ï∂îÍ∞Ä -->
                        </select>
                    </div>
                </div>

                <div class="settings-row">
                    <div class="setting-item">
                        <label>ÎÇúÏù¥ÎèÑ ÏÑ§Ï†ï</label>
                        <div id="difficulty-select" class="btn-group">
                            <button class="difficulty-btn" data-value="EASY">EASY</button>
                            <button class="difficulty-btn active" data-value="NORMAL">NORMAL</button>
                            <button class="difficulty-btn" data-value="HARD">HARD</button>
                        </div>
                    </div>
                </div>

                <div class="settings-row">
                    <div class="setting-item">
                        <label>ÎÖ∏Ìä∏ ÏÜçÎèÑ</label>
                        <input type="range" id="scroll-speed" min="1" max="10" value="4" step="0.5">
                        <span id="speed-value">4.0</span>
                    </div>
                </div>

                <button id="start-btn" class="primary-btn" style="margin-top: 2rem;">START SESSION</button>
                <button id="settings-btn" class="secondary-btn" style="margin-top: 0.75rem;">‚öôÔ∏è SETTINGS</button>

                <div class="settings-row"
                    style="margin-top: 1.5rem; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 1rem;">
                    <div class="control-item" style="width: 100%;">
                        <label style="opacity: 0.6; font-size: 0.8rem;">ÎòêÎäî Í∞úÏù∏ MIDI ÌååÏùº ÏßÅÏ†ë ÏóÖÎ°úÎìú</label>
                        <input type="file" id="midi-upload" accept=".mid,.midi" style="width: 100%; opacity: 0.7;">
                    </div>
                </div>
            </div>
        </div>

        <!-- Game Interface -->
        <main id="game-container">
            <!-- HP Gauge (Vertical Sidebar) -->
            <div id="hp-container">
                <div id="hp-bar-fill"></div>
                <div class="hp-label">HP</div>
            </div>

            <div id="hud">
                <div class="hud-top">
                    <div class="score-container">
                        <span class="label">SCORE</span>
                        <span id="score">000000</span>
                    </div>
                    <div class="hud-controls">
                        <button id="pause-btn" class="icon-btn">II</button>
                        <button id="fullscreen-btn" class="icon-btn">FS</button>
                    </div>
                    <div class="combo-container">
                        <span id="combo">0</span>
                        <span class="label">COMBO</span>
                    </div>
                </div>
                <div class="hud-bottom">
                    <div class="progress-bar-bg">
                        <div id="progress-bar-fill"></div>
                    </div>
                    <span id="time-display">00:00 / 00:00</span>
                </div>
            </div>

            <div id="judgment-display"></div>

            <!-- Visual Effects Elements -->
            <div id="screen-glow"></div>
            <div id="transition-overlay"></div>
            <div id="countdown-display"></div>

            <!-- Pause Button -->
            <button id="pause-btn" class="icon-btn" title="Pause (ESC)" style="display: none;">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="6" y="4" width="4" height="16" />
                    <rect x="14" y="4" width="4" height="16" />
                </svg>
            </button>

            <!-- Progress Bar -->
            <div id="progress-container" style="display: none;">
                <div id="progress-bar">
                    <div id="progress-fill"></div>
                </div>
                <div id="progress-time">
                    <span id="current-time">0:00</span> / <span id="total-time">0:00</span>
                </div>
            </div>

            <!-- Visual Equalizer -->
            <div id="visual-equalizer"></div>

            <canvas id="game-canvas"></canvas>

            <!-- Touch Zones for Mobile & Hand-feel -->
            <div id="touch-zones">
                <div class="touch-zone arcade-btn" data-lane="0" data-key="D">
                    <div class="arcade-icon kick"></div>
                </div>
                <div class="touch-zone arcade-btn" data-lane="1" data-key="F">
                    <div class="arcade-icon snare"></div>
                </div>
                <div class="touch-zone arcade-btn" data-lane="2" data-key="J">
                    <div class="arcade-icon hihat"></div>
                </div>
                <div class="touch-zone arcade-btn" data-lane="3" data-key="K">
                    <div class="arcade-icon crash"></div>
                </div>
            </div>

            <!-- Pause Menu Overlay -->
            <div id="pause-overlay" class="game-overlay" style="display: none;">
                <div class="pause-menu glass-panel">
                    <h2 class="title">PAUSED</h2>
                    <div class="pause-buttons">
                        <button id="resume-btn" class="menu-btn primary-btn">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <polygon points="5,3 19,12 5,21" />
                            </svg>
                            RESUME
                        </button>
                        <button id="restart-btn" class="menu-btn">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8" />
                                <path d="M21 3v5h-5" />
                                <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16" />
                            </svg>
                            RESTART
                        </button>
                        <button id="menu-btn" class="menu-btn">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M3 12h18M3 6h18M3 18h18" />
                            </svg>
                            MAIN MENU
                        </button>
                    </div>
                </div>
            </div>

            <!-- Result Overlay -->
            <div id="result-overlay" class="game-overlay" style="display: none;">
                <div class="result-box glass-panel">
                    <h2 class="title">SESSION COMPLETE</h2>
                    <div class="rank-display">
                        <span id="result-rank">-</span>
                        <p>RANK</p>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <span class="label">PERFECT</span>
                            <span id="stat-perfect" class="value perfect">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="label">GOOD</span>
                            <span id="stat-good" class="value good">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="label">MISS</span>
                            <span id="stat-miss" class="value miss">0</span>
                        </div>
                    </div>
                    <div class="stat-summary">
                        <div class="stat-row">
                            <span>MAX COMBO</span>
                            <span id="stat-maxcombo">0</span>
                        </div>
                        <div class="stat-row highlight">
                            <span>TOTAL SCORE</span>
                            <span id="stat-score">000000</span>
                        </div>
                    </div>
                    <button class="primary-btn restart-btn">RETRY SESSION</button>
                    <button class="secondary-btn home-btn">BACK TO MENU</button>
                </div>
            </div>

            <!-- Game Over Overlay -->
            <div id="game-over-overlay" class="game-overlay" style="display: none;">
                <div class="fail-box glass-panel">
                    <h2 class="title fail">SESSION FAILED</h2>
                    <p class="fail-msg">HP DEPLETED</p>
                    <button class="primary-btn restart-btn">RETRY SESSION</button>
                    <button class="secondary-btn home-btn">BACK TO MENU</button>
                </div>
            </div>

        </main>

        <!-- Settings Overlay -->
        <div id="settings-overlay" class="game-overlay" style="display: none;">
            <!-- Full-screen Preview Canvas (left side) -->
            <canvas id="layout-preview-canvas"></canvas>

            <div class="settings-panel">
                <div class="settings-header">
                    <h2>‚öôÔ∏è SETTINGS</h2>
                    <button id="close-settings-btn" class="close-btn">‚úï</button>
                </div>

                <div class="settings-tabs">
                    <button class="tab-btn active" data-tab="layout">Layout</button>
                    <button class="tab-btn" data-tab="audio" disabled style="opacity: 0.5;">Audio</button>
                    <button class="tab-btn" data-tab="controls" disabled style="opacity: 0.5;">Controls</button>
                </div>

                <div class="settings-content">
                    <!-- Layout Tab -->
                    <div id="layout-tab" class="tab-content active">
                        <p class="settings-hint">üí° Í≤åÏûÑ ÌôîÎ©¥ÏùÑ Î≥¥Î©¥ÏÑú Ïã§ÏãúÍ∞ÑÏúºÎ°ú Î†àÏù¥ÏïÑÏõÉÏùÑ Ï°∞Ï†ïÌïòÏÑ∏Ïöî</p>

                        <div class="control-group">
                            <label>Hit Line Position</label>
                            <div class="slider-container">
                                <input type="range" id="hitline-slider" min="50" max="90" value="70" step="1">
                                <span class="value-display" id="hitline-value">70%</span>
                            </div>
                        </div>

                        <div class="control-group">
                            <label>Score Position</label>
                            <div class="slider-container">
                                <input type="range" id="score-pos-slider" min="60" max="95" value="72" step="1">
                                <span class="value-display" id="score-pos-value">72%</span>
                            </div>
                        </div>

                        <div class="control-group">
                            <label>Score Font Size</label>
                            <div class="slider-container">
                                <input type="range" id="score-size-slider" min="20" max="48" value="28" step="2">
                                <span class="value-display" id="score-size-value">28px</span>
                            </div>
                        </div>

                        <div class="control-group">
                            <label>Combo Position</label>
                            <div class="slider-container">
                                <input type="range" id="combo-pos-slider" min="100" max="300" value="150" step="5">
                                <span class="value-display" id="combo-pos-value">150px</span>
                            </div>
                        </div>

                        <div class="control-group">
                            <label>Touch Zone Top</label>
                            <div class="slider-container">
                                <input type="range" id="touchzone-slider" min="50" max="80" value="70" step="1">
                                <span class="value-display" id="touchzone-value">70%</span>
                            </div>
                        </div>

                        <div class="preset-section">
                            <h3>Presets</h3>
                            <div class="preset-buttons">
                                <button class="preset-btn" data-preset="1">Default</button>
                                <button class="preset-btn" data-preset="2">Compact</button>
                                <button class="preset-btn" data-preset="3">Spacious</button>
                            </div>
                        </div>

                        <div class="action-buttons">
                            <button id="save-settings-btn" class="primary-btn">üíæ Save</button>
                            <button id="reset-settings-btn" class="secondary-btn">üîÑ Reset</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Debug Console -->
        <div id="debug-console"></div>
    </div>

    <script type="module">
        import(`./main.js?v=${Date.now()}`);
    </script>
</body>

</html>